{% extends "base.html" %}

{% block title %}Data Verification Dashboard{% endblock %}

{% block content %}
    <div> {# Removed jumbotron and mt-4 #}
        <h1>Dashboard</h1>
        <p>Select a metric below to view the detailed checks, or see the latest Z-Score summary below.</p>
        <div>
            {% for metric in metrics %}
            <div>
                <div>
                    <div>
                        <h5>{{ metric }}</h5>
                        <p>View details for {{ metric }}.</p>
                        {% set metric_url = url_for('metric.metric_page', metric_name=metric) %}
                        <a href="{{ metric_url }}">View Details</a>
                        <span>Debug URL: {{ metric_url }}</span>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Z-Score Summary Table -->
    {% if not summary_data.empty %}
    <h2>Latest Change Z-Score Summary</h2>
    <div>
        <table>
            <thead>
                <tr>
                    <th>Fund Code</th>
                    {% for full_metric_name in summary_metrics %}
                    <th>{{ full_metric_name }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody>
                {% for fund_code, row in summary_data.iterrows() %}
                <tr>
                    <td><a href="{{ url_for('fund.fund_detail', fund_code=fund_code) }}" title="View all metrics for {{ fund_code }}">{{ fund_code }}</a></td>
                    {% for full_metric_name in summary_metrics %}
                        {% set z_score = row[full_metric_name] %}
                        {% if z_score is none or z_score != z_score %}
                            <td>N/A</td>
                        {% else %}
                            {% set z_abs = z_score|abs %}
                            {% set cell_class = '' %}
                            {% if z_abs > 3.0 %}
                                {% set cell_class = 'table-danger' %}
                            {% elif z_abs > 2.0 %}
                                {% set cell_class = 'table-warning' %}
                            {% endif %}
                            <td class="{{ cell_class }}">{{ "%.2f"|format(z_score) }}</td>
                        {% endif %}
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div>
        No Z-score data could be generated for the summary table. Check the console logs for errors.
    </div>
    {% endif %}

    <div>
        <h5>Get Data via API (Simulated)</h5>
        <p>Select funds and dates to simulate retrieving data from the Rex API.</p>
        <a href="{{ url_for('api_bp.get_data_page') }}">Go to Get Data Page</a>
    </div>

    <div>
        <h5>Securities Data Check</h5>
        <p>View checks for individual securities based on latest daily changes.</p>
        <a href="{{ url_for('security.securities_page') }}">View Securities Check</a>
    </div>
{% endblock %}

{% block scripts %}
{# Add any page-specific scripts here if needed in the future #}
{% endblock %} 